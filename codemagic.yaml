workflows:
  build_for_test:
    name: Build Android and iOS for testing
    environment:
      flutter: stable
      xcode: latest
      cocoapods: default
      vars:
        APP_NAME: "LeisureRyde"
        BUNDLE_ID: "com.leisureryde.ride"
        APPLE_ID: "Ibraheemakin201@gmail.com"
        APP_STORE_CONNECT_ISSUER_ID: $APP_STORE_CONNECT_ISSUER_ID
        APP_STORE_CONNECT_KEY_IDENTIFIER: $APP_STORE_CONNECT_KEY_IDENTIFIER
        APP_STORE_CONNECT_PRIVATE_KEY: $APP_STORE_CONNECT_PRIVATE_KEY

    scripts:
      - flutter clean
      - flutter pub get
      - flutter build apk --release
      - flutter build ios --release --no-codesign
      - |
        xcode-project build-ipa \
          --workspace ios/Runner.xcworkspace \
          --scheme Runner \
          --archive-path build/Runner.xcarchive \
          --export-options-plist ios/exportOptions.plist

    artifacts:
      - build/app/outputs/flutter-apk/*.apk
      - build/ios/ipa/*.ipa

    publishing:
      app_store_connect:
        apple_id: "Ibraheemakin201@gmail.com"
        submit_to_testflight: true
